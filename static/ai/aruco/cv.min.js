var CV=CV||{};CV.Image=function(a,c,b){this.width=a||0;this.height=c||0;this.data=b||[]};CV.grayscale=function(a,c){for(var b=a.data,d=c.data,g=b.length,h=0,k=0;h<g;h+=4)d[k++]=.299*b[h]+.587*b[h+1]+.114*b[h+2]+.5&255;c.width=a.width;c.height=a.height;return c};CV.threshold=function(a,c,b){var d=a.data,g=c.data,h=d.length,k=[],f;for(f=0;256>f;++f)k[f]=f<=b?0:255;for(f=0;f<h;++f)g[f]=k[d[f]];c.width=a.width;c.height=a.height;return c};
CV.adaptiveThreshold=function(a,c,b,d){var g=a.data,h=c.data,k=g.length,f=[];CV.stackBoxBlur(a,c,b);for(b=0;768>b;++b)f[b]=b-255<=-d?255:0;for(b=0;b<k;++b)h[b]=f[g[b]-h[b]+255];c.width=a.width;c.height=a.height;return c};CV.otsu=function(a){var c=a.data;a=c.length;var b=[],d=0,g=0,h=0,k=0,f=0,e;for(e=0;256>e;++e)b[e]=0;for(e=0;e<a;++e)b[c[e]]++;for(e=0;256>e;++e)g+=b[e]*e;for(e=0;256>e;++e)if(k+=b[e],0!==k){c=a-k;if(0===c)break;h+=b[e]*e;var l=h/k-(g-h)/c;c=k*c*l*l;c>f&&(f=c,d=e)}return d};
CV.stackBoxBlurMult=[1,171,205,293,57,373,79,137,241,27,391,357,41,19,283,265];CV.stackBoxBlurShift=[0,9,10,11,9,12,10,11,12,9,13,13,10,9,13,13];CV.BlurStack=function(){this.color=0;this.next=null};
CV.stackBoxBlur=function(a,c,b){var d=a.data,g=c.data,h=a.height;a=a.width;var k=h-1,f=a-1,e=b+b+1,l=b+1,q=CV.stackBoxBlurMult[b];b=CV.stackBoxBlurShift[b];var n,p,m,t,u;var r=n=new CV.BlurStack;for(m=1;m<e;++m)r=r.next=new CV.BlurStack;r.next=n;for(u=p=0;u<h;++u){var w=p;var v=d[p];e=l*v;r=n;for(m=0;m<l;++m)r.color=v,r=r.next;for(m=1;m<l;++m)r.color=d[p+m],e+=r.color,r=r.next;r=n;for(t=0;t<a;++t)g[p++]=e*q>>>b,m=t+l,m=w+(m<f?m:f),e-=r.color-d[m],r.color=d[m],r=r.next}for(t=0;t<a;++t){p=t;w=p+a;v=
g[p];e=l*v;r=n;for(m=0;m<l;++m)r.color=v,r=r.next;for(m=1;m<l;++m)r.color=g[w],e+=r.color,r=r.next,w+=a;r=n;for(u=0;u<h;++u)g[p]=e*q>>>b,m=u+l,m=t+(m<k?m:k)*a,e-=r.color-g[m],r.color=g[m],r=r.next,p+=a}return c};CV.gaussianBlur=function(a,c,b,d){d=CV.gaussianKernel(d);c.width=a.width;c.height=a.height;b.width=a.width;b.height=a.height;CV.gaussianBlurFilter(a,b,d,!0);CV.gaussianBlurFilter(b,c,d,!1);return c};
CV.gaussianBlurFilter=function(a,c,b,d){var g=a.data,h=c.data,k=a.height;a=a.width;var f=0,e=b.length>>1,l,q,n;for(l=0;l<k;++l)for(q=0;q<a;++q){var p=0;for(n=-e;n<=e;++n){if(d){var m=f+n;0>q+n?m=f:q+n>=a&&(m=f)}else m=f+n*a,0>l+n?m=f:l+n>=k&&(m=f);p+=b[e+n]*g[m]}h[f++]=d?p:p+.5&255}return c};
CV.gaussianKernel=function(a){var c=[[1],[.25,.5,.25],[.0625,.25,.375,.25,.0625],[.03125,.109375,.21875,.28125,.21875,.109375,.03125]],b=[],d,g;if(7>=a&&1===a%2)b=c[a>>1];else{c=.5*(a-1);var h=.8+.3*(c-1);h=-.5/(h*h);for(g=d=0;g<a;++g){var k=g-c;d+=b[g]=Math.exp(h*k*k)}d=1/d;for(g=0;g<a;++g)b[g]*=d}return b};
CV.findContours=function(a,c){var b=a.width,d=a.height,g=[],h,k,f;var e=CV.binaryBorder(a,c);var l=CV.neighborhoodDeltas(b+2);var q=b+3;var n=1;for(k=0;k<d;++k,q+=2)for(f=0;f<b;++f,++q){var p=e[q];if(0!==p){var m=h=!1;1===p&&0===e[q-1]?m=!0:1<=p&&0===e[q+1]&&(h=!0);if(m||h)++n,g.push(CV.borderFollowing(e,q,n,{x:f,y:k},h,l))}}return g};
CV.borderFollowing=function(a,c,b,d,g,h){var k=[],f,e;var l=e=(k.hole=g)?0:4;do if(l=l-1&7,g=c+h[l],0!==a[g])break;while(l!==e);if(l===e)a[c]=-b,k.push({x:d.x,y:d.y});else for(f=c;;){e=l;do var q=f+h[++l];while(0===a[q]);l&=7;l-1>>>0<e>>>0?a[f]=-b:1===a[f]&&(a[f]=b);k.push({x:d.x,y:d.y});d.x+=CV.neighborhood[l][0];d.y+=CV.neighborhood[l][1];if(q===c&&f===g)break;f=q;l=l+4&7}return k};CV.neighborhood=[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[-1,1],[0,1],[1,1]];
CV.neighborhoodDeltas=function(a){for(var c=[],b=CV.neighborhood.length,d=0;d<b;++d)c[d]=CV.neighborhood[d][0]+CV.neighborhood[d][1]*a;return c.concat(c)};
CV.approxPolyDP=function(a,c){var b={start_index:0,end_index:0},d=0,g=[],h=[],k=a.length,f,e,l;c*=c;for(f=l=0;3>f;++f){var q=0;l=(l+d)%k;var n=a[l];++l===k&&(l=0);for(e=1;e<k;++e){var p=a[l];++l===k&&(l=0);var m=p.x-n.x;var t=p.y-n.y;p=m*m+t*t;p>q&&(q=p,d=e)}}q<=c?g.push({x:n.x,y:n.y}):(b.start_index=l,b.end_index=d+=b.start_index,d-=d>=k?k:0,n=b.start_index,n<d&&(n+=k),h.push({start_index:d,end_index:n}),h.push({start_index:b.start_index,end_index:b.end_index}));for(;0!==h.length;){b=h.pop();t=a[b.end_index%
k];n=a[l=b.start_index%k];++l===k&&(l=0);if(b.end_index<=b.start_index+1)q=!0;else{q=0;m=t.x-n.x;t=t.y-n.y;for(f=b.start_index+1;f<b.end_index;++f)p=a[l],++l===k&&(l=0),p=Math.abs((p.y-n.y)*m-(p.x-n.x)*t),p>q&&(q=p,d=f);q=q*q<=c*(m*m+t*t)}q?g.push({x:n.x,y:n.y}):(n=b.end_index,b.end_index=d,h.push({start_index:d,end_index:n}),h.push({start_index:b.start_index,end_index:b.end_index}))}return g};
CV.warp=function(a,c,b,d){var g=a.data,h=c.data,k=a.width;a=a.height;var f=0,e,l,q,n;var p=CV.getPerspectiveTransform(b,d-1);var m=p[8];var t=p[2];var u=p[5];for(q=0;q<d;++q){m+=p[7];t+=p[1];u+=p[4];var r=m;var w=t;var v=u;for(n=0;n<d;++n){r+=p[6];w+=p[0];v+=p[3];var y=w/r;var z=v/r;b=y>>>0;var B=b===k-1?b:b+1;y-=b;var C=1-y;var x=z>>>0;var A=x===a-1?x:x+1;z-=x;var D=1-z;x=e=x*k;A=l=A*k;h[f++]=D*(C*g[x+b]+y*g[e+B])+z*(C*g[A+b]+y*g[l+B])&255}}c.width=d;c.height=d;return c};
CV.getPerspectiveTransform=function(a,c){var b=CV.square2quad(a);b[0]/=c;b[1]/=c;b[3]/=c;b[4]/=c;b[6]/=c;b[7]/=c;return b};
CV.square2quad=function(a){var c=[];var b=a[0].x-a[1].x+a[2].x-a[3].x;var d=a[0].y-a[1].y+a[2].y-a[3].y;if(0===b&&0===d)c[0]=a[1].x-a[0].x,c[1]=a[2].x-a[1].x,c[2]=a[0].x,c[3]=a[1].y-a[0].y,c[4]=a[2].y-a[1].y,c[5]=a[0].y,c[6]=0,c[7]=0,c[8]=1;else{var g=a[1].x-a[2].x;var h=a[3].x-a[2].x;var k=a[1].y-a[2].y;var f=a[3].y-a[2].y;var e=g*f-h*k;c[6]=(b*f-h*d)/e;c[7]=(g*d-b*k)/e;c[8]=1;c[0]=a[1].x-a[0].x+c[6]*a[1].x;c[1]=a[3].x-a[0].x+c[7]*a[3].x;c[2]=a[0].x;c[3]=a[1].y-a[0].y+c[6]*a[1].y;c[4]=a[3].y-a[0].y+
c[7]*a[3].y;c[5]=a[0].y}return c};CV.isContourConvex=function(a){var c=0,b=!0,d=a.length,g=0,h=0,k;var f=a[d-1];var e=a[0];var l=e.x-f.x;for(k=e.y-f.y;g<d;++g){++h===d&&(h=0);f=e;e=a[h];var q=e.x-f.x;f=e.y-f.y;k*=q;l*=f;c|=l>k?1:l<k?2:3;if(3===c){b=!1;break}l=q;k=f}return b};CV.perimeter=function(a){for(var c=a.length,b=0,d=c-1,g=0,h;b<c;d=b++)h=a[b].x-a[d].x,d=a[b].y-a[d].y,g+=Math.sqrt(h*h+d*d);return g};
CV.minEdgeLength=function(a){for(var c=a.length,b=0,d=c-1,g=Infinity,h;b<c;d=b++)h=a[b].x-a[d].x,d=a[b].y-a[d].y,h=h*h+d*d,h<g&&(g=h);return Math.sqrt(g)};CV.countNonZero=function(a,c){var b=a.data,d=c.height,g=c.width,h=c.x+c.y*a.width,k=a.width-g,f=0,e,l;for(e=0;e<d;++e){for(l=0;l<g;++l)0!==b[h++]&&++f;h+=k}return f};
CV.binaryBorder=function(a,c){var b=a.data,d=a.height,g=a.width,h=0,k=0,f,e;for(e=-2;e<g;++e)c[k++]=0;for(f=0;f<d;++f){for(e=c[k++]=0;e<g;++e)c[k++]=0===b[h++]?0:1;c[k++]=0}for(e=-2;e<g;++e)c[k++]=0;return c};