/*
 BSD
*/
(function(a,b){a.tracking=a.tracking||{};tracking.inherits=function(a,c){function d(){}d.prototype=c.prototype;a.superClass_=c.prototype;a.prototype=new d;a.prototype.constructor=a;a.base=function(a,d){var b=Array.prototype.slice.call(arguments,2);return c.prototype[d].apply(a,b)}};tracking.initUserMedia_=function(d,c){a.navigator.mediaDevices.getUserMedia({video:!0,audio:c&&c.audio?!0:!1}).then(function(a){d.srcObject=a})["catch"](function(a){throw Error("Cannot capture user camera.");})};tracking.isNode=
function(a){return a.nodeType||this.isWindow(a)};tracking.isWindow=function(a){return!!(a&&a.alert&&a.document)};tracking.one=function(a,c){return this.isNode(a)?a:(c||document).querySelector(a)};tracking.track=function(a,c,b){a=tracking.one(a);if(!a)throw Error("Element not found, try a different element or selector.");if(!c)throw Error("Tracker not specified, try `tracking.track(element, new tracking.FaceTracker())`.");switch(a.nodeName.toLowerCase()){case "canvas":return this.trackCanvas_(a,c,
b);case "img":return this.trackImg_(a,c,b);case "video":return this.trackVideo_(a,c,b);default:throw Error("Element not supported, try in a canvas, img, or video.");}};tracking.trackCanvas_=function(a,c){var d=this,b=new tracking.TrackerTask(c);b.on("run",function(){d.trackCanvasInternal_(a,c)});return b.run()};tracking.trackCanvasInternal_=function(a,c){var d=a.width,b=a.height,g=a.getContext("2d").getImageData(0,0,d,b);c.track(g.data,d,b)};tracking.trackImg_=function(a,c){var d=a.width,b=a.height,
g=document.createElement("canvas");g.width=d;g.height=b;var h=new tracking.TrackerTask(c);h.on("run",function(){tracking.Canvas.loadImage(g,a.src,0,0,d,b,function(){tracking.trackCanvasInternal_(g,c)})});return h.run()};tracking.trackVideo_=function(d,c){var b=document.createElement("canvas"),f=b.getContext("2d"),g,h,k=function(){g=d.offsetWidth;h=d.offsetHeight;b.width=g;b.height=h};k();d.addEventListener("resize",k);var l,m=function(){l=a.requestAnimationFrame(function(){if(d.readyState===d.HAVE_ENOUGH_DATA){try{f.drawImage(d,
0,0,g,h)}catch(n){}tracking.trackCanvasInternal_(b,c)}m()})};k=new tracking.TrackerTask(c);k.on("stop",function(){a.cancelAnimationFrame(l)});k.on("run",function(){m()});return k.run()};a.URL||(a.URL=a.URL||a.webkitURL||a.msURL||a.oURL);navigator.getUserMedia||(navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)})(window);
(function(){tracking.EventEmitter=function(){};tracking.EventEmitter.prototype.events_=null;tracking.EventEmitter.prototype.addListener=function(a,b){if("function"!==typeof b)throw new TypeError("Listener must be a function");this.events_||(this.events_={});this.emit("newListener",a,b);this.events_[a]||(this.events_[a]=[]);this.events_[a].push(b);return this};tracking.EventEmitter.prototype.listeners=function(a){return this.events_&&this.events_[a]};tracking.EventEmitter.prototype.emit=function(a){var b=
this.listeners(a);if(b){for(var d=Array.prototype.slice.call(arguments,1),c=0;c<b.length;c++)b[c]&&b[c].apply(this,d);return!0}return!1};tracking.EventEmitter.prototype.on=tracking.EventEmitter.prototype.addListener;tracking.EventEmitter.prototype.once=function(a,b){var d=this;d.on(a,function e(){d.removeListener(a,e);b.apply(this,arguments)})};tracking.EventEmitter.prototype.removeAllListeners=function(a){if(!this.events_)return this;a?delete this.events_[a]:delete this.events_;return this};tracking.EventEmitter.prototype.removeListener=
function(a,b){if("function"!==typeof b)throw new TypeError("Listener must be a function");if(!this.events_)return this;var d=this.listeners(a);if(Array.isArray(d)){var c=d.indexOf(b);if(0>c)return this;d.splice(c,1)}return this};tracking.EventEmitter.prototype.setMaxListeners=function(){throw Error("Not implemented");}})();
(function(){tracking.Canvas={};tracking.Canvas.loadImage=function(a,b,d,c,e,f,g){var h=this,k=new window.Image;k.crossOrigin="*";k.onload=function(){var b=a.getContext("2d");a.width=e;a.height=f;b.drawImage(k,d,c,e,f);g&&g.call(h);k=null};k.src=b}})();
(function(){tracking.DisjointSet=function(a){if(void 0===a)throw Error("DisjointSet length not specified.");this.length=a;this.parent=new Uint32Array(a);for(var b=0;b<a;b++)this.parent[b]=b};tracking.DisjointSet.prototype.length=null;tracking.DisjointSet.prototype.parent=null;tracking.DisjointSet.prototype.find=function(a){return this.parent[a]===a?a:this.parent[a]=this.find(this.parent[a])};tracking.DisjointSet.prototype.union=function(a,b){var d=this.find(a),c=this.find(b);this.parent[d]=c}})();
(function(){tracking.Image={};tracking.Image.blur=function(a,b,d,c){c=Math.abs(c);if(1>=c)throw Error("Diameter should be greater than 1.");var e=c/2,f=Math.ceil(c)+(1-Math.ceil(c)%2);c=new Float32Array(f);var g=(e+.5)/3;e=1/Math.sqrt(2*Math.PI*g*g);var h=-1/(2*g*g);g=0;for(var k=Math.floor(f/2),l=0;l<f;l++){var m=l-k;m=e*Math.exp(m*m*h);c[l]=m;g+=m}for(f=0;f<c.length;f++)c[f]/=g;return this.separableConvolve(a,b,d,c,c,!1)};tracking.Image.computeIntegralImage=function(a,b,d,c,e,f,g){if(4>arguments.length)throw Error("You should specify at least one output array in the order: sum, square, tilted, sobel.");
var h;g&&(h=tracking.Image.sobel(a,b,d));for(var k=0;k<d;k++)for(var l=0;l<b;l++){var m=k*b*4+4*l,n=~~(.299*a[m]+.587*a[m+1]+.114*a[m+2]);c&&this.computePixelValueSAT_(c,b,k,l,n);e&&this.computePixelValueSAT_(e,b,k,l,n*n);if(f){var p=m-4*b;this.computePixelValueRSAT_(f,b,k,l,n,~~(.299*a[p]+.587*a[p+1]+.114*a[p+2])||0)}g&&this.computePixelValueSAT_(g,b,k,l,h[m])}};tracking.Image.computePixelValueRSAT_=function(a,b,d,c,e,f){d=d*b+c;a[d]=(a[d-b-1]||0)+(a[d-b+1]||0)-(a[d-b-b]||0)+e+f};tracking.Image.computePixelValueSAT_=
function(a,b,d,c,e){d=d*b+c;a[d]=(a[d-b]||0)+(a[d-1]||0)+e-(a[d-b-1]||0)};tracking.Image.grayscale=function(a,b,d,c){for(var e=new Uint8ClampedArray(c?a.length:a.length>>2),f=0,g=0,h=0;h<d;h++)for(var k=0;k<b;k++){var l=.299*a[g]+.587*a[g+1]+.114*a[g+2];e[f++]=l;c&&(e[f++]=l,e[f++]=l,e[f++]=a[g+3]);g+=4}return e};tracking.Image.horizontalConvolve=function(a,b,d,c,e){var f=c.length,g=Math.floor(f/2),h=new Float32Array(b*d*4);e=e?1:0;for(var k=0;k<d;k++)for(var l=0;l<b;l++){for(var m=k,n=l,p=4*(k*b+
l),v=0,x=0,w=0,u=0,t=0;t<f;t++){var q=4*(m*b+Math.min(b-1,Math.max(0,n+t-g))),r=c[t];v+=a[q]*r;x+=a[q+1]*r;w+=a[q+2]*r;u+=a[q+3]*r}h[p]=v;h[p+1]=x;h[p+2]=w;h[p+3]=u+e*(255-u)}return h};tracking.Image.verticalConvolve=function(a,b,d,c,e){var f=c.length,g=Math.floor(f/2),h=new Float32Array(b*d*4);e=e?1:0;for(var k=0;k<d;k++)for(var l=0;l<b;l++){for(var m=k,n=l,p=4*(k*b+l),v=0,x=0,w=0,u=0,t=0;t<f;t++){var q=4*(Math.min(d-1,Math.max(0,m+t-g))*b+n),r=c[t];v+=a[q]*r;x+=a[q+1]*r;w+=a[q+2]*r;u+=a[q+3]*r}h[p]=
v;h[p+1]=x;h[p+2]=w;h[p+3]=u+e*(255-u)}return h};tracking.Image.separableConvolve=function(a,b,d,c,e,f){a=this.verticalConvolve(a,b,d,e,f);return this.horizontalConvolve(a,b,d,c,f)};tracking.Image.sobel=function(a,b,d){a=this.grayscale(a,b,d,!0);var c=new Float32Array(b*d*4),e=new Float32Array([-1,0,1]),f=new Float32Array([1,2,1]),g=this.separableConvolve(a,b,d,e,f);a=this.separableConvolve(a,b,d,f,e);for(b=0;b<c.length;b+=4)d=g[b],e=a[b],d=Math.sqrt(e*e+d*d),c[b]=d,c[b+1]=d,c[b+2]=d,c[b+3]=255;return c};
tracking.Image.equalizeHist=function(a,b,d){b=new Uint8ClampedArray(a.length);d=Array(256);for(var c=0;256>c;c++)d[c]=0;for(c=0;c<a.length;c++)b[c]=a[c],d[a[c]]++;var e=d[0];for(c=0;256>c;c++)d[c]+=e,e=d[c];e=255/a.length;for(c=0;c<a.length;c++)b[c]=d[a[c]]*e+.5|0;return b}})();
(function(){tracking.ViolaJones={};tracking.ViolaJones.REGIONS_OVERLAP=.5;tracking.ViolaJones.classifiers={};tracking.ViolaJones.detect=function(a,b,d,c,e,f,g,h){var k=0,l=[],m=new Int32Array(b*d),n=new Int32Array(b*d),p=new Int32Array(b*d),v;0<g&&(v=new Int32Array(b*d));tracking.Image.computeIntegralImage(a,b,d,m,n,p,v);a=h[0];var x=h[1];c*=e;for(var w=c*a|0,u=c*x|0;w<b&&u<d;){for(var t=c*f+.5|0,q=0;q<d-u;q+=t)for(var r=0;r<b-w;r+=t)0<g&&this.isTriviallyExcluded(g,v,q,r,b,w,u)||this.evalStages_(h,
m,n,p,q,r,b,w,u,c)&&(l[k++]={width:w,height:u,x:r,y:q});c*=e;w=c*a|0;u=c*x|0}return this.mergeRectangles_(l)};tracking.ViolaJones.isTriviallyExcluded=function(a,b,d,c,e,f,g){d=d*e+c;e=d+g*e;return(b[d]-b[d+f]-b[e]+b[e+f])/(f*g*255)<a?!0:!1};tracking.ViolaJones.evalStages_=function(a,b,d,c,e,f,g,h,k,l){var m=1/(h*k),n=e*g+f,p=n+h;k=n+k*g;h=k+h;var v=(b[n]-b[p]-b[k]+b[h])*m;n=(d[n]-d[p]-d[k]+d[h])*m-v*v;d=1;0<n&&(d=Math.sqrt(n));n=a.length;for(p=2;p<n;){k=0;h=a[p++];for(v=a[p++];v--;){for(var x=0,w=
a[p++],u=a[p++],t=0;t<u;t++){var q=f+a[p++]*l+.5|0,r=e+a[p++]*l+.5|0,z=a[p++]*l+.5|0,y=a[p++]*l+.5|0,C=a[p++];if(w){var A=q-y+z+(r+z+y-1)*g;var B=q+(r-1)*g;y=q-y+(r+y-1)*g;q=q+z+(r+z-1)*g;x+=(c[A]+c[B]-c[y]-c[q])*C}else A=r*g+q,B=A+z,y=A+y*g,q=y+z,x+=(b[A]-b[B]-b[y]+b[q])*C}w=a[p++];u=a[p++];t=a[p++];k=x*m<w*d?k+u:k+t}if(k<h)return!1}return!0};tracking.ViolaJones.mergeRectangles_=function(a){for(var b=new tracking.DisjointSet(a.length),d=0;d<a.length;d++)for(var c=a[d],e=0;e<a.length;e++){var f=a[e];
if(tracking.Math.intersectRect(c.x,c.y,c.x+c.width,c.y+c.height,f.x,f.y,f.x+f.width,f.y+f.height)){var g=(Math.max(c.x,f.x)-Math.min(c.x+c.width,f.x+f.width))*(Math.max(c.y,f.y)-Math.min(c.y+c.height,f.y+f.height)),h=c.width*c.height;f=f.width*f.height;g/(h/f*h)>=this.REGIONS_OVERLAP&&g/(h/f*f)>=this.REGIONS_OVERLAP&&b.union(d,e)}}var k={};for(d=0;d<b.length;d++)c=b.find(d),k[c]?(k[c].total++,k[c].width+=a[d].width,k[c].height+=a[d].height,k[c].x+=a[d].x,k[c].y+=a[d].y):k[c]={total:1,width:a[d].width,
height:a[d].height,x:a[d].x,y:a[d].y};var l=[];Object.keys(k).forEach(function(a){a=k[a];l.push({total:a.total,width:a.width/a.total+.5|0,height:a.height/a.total+.5|0,x:a.x/a.total+.5|0,y:a.y/a.total+.5|0})});return l}})();
(function(){tracking.Brief={};tracking.Brief.N=512;tracking.Brief.randomImageOffsets_={};tracking.Brief.randomWindowOffsets_=null;tracking.Brief.getDescriptors=function(a,b,d){for(var c=new Int32Array((d.length>>1)*(this.N>>5)),e=0,f=this.getRandomOffsets_(b),g=0,h=0;h<d.length;h+=2)for(var k=b*d[h+1]+d[h],l=0,m=0,n=this.N;m<n;m++)a[f[l++]+k]<a[f[l++]+k]&&(e|=1<<(m&31)),m+1&31||(c[g++]=e,e=0);return c};tracking.Brief.match=function(a,b,d,c){for(var e=a.length>>1,f=d.length>>1,g=Array(e),h=0;h<e;h++){for(var k=
Infinity,l=0,m=0;m<f;m++){for(var n=0,p=0,v=this.N>>5;p<v;p++)n+=tracking.Math.hammingWeight(b[h*v+p]^c[m*v+p]);n<k&&(k=n,l=m)}g[h]={index1:h,index2:l,keypoint1:[a[2*h],a[2*h+1]],keypoint2:[d[2*l],d[2*l+1]],confidence:1-k/this.N}}return g};tracking.Brief.reciprocalMatch=function(a,b,d,c){var e=[];if(0===a.length||0===d.length)return e;var f=tracking.Brief.match(a,b,d,c);a=tracking.Brief.match(d,c,a,b);for(b=0;b<f.length;b++)a[f[b].index2].index2===b&&e.push(f[b]);return e};tracking.Brief.getRandomOffsets_=
function(a){if(!this.randomWindowOffsets_){for(var b=0,d=new Int32Array(4*this.N),c=0;c<this.N;c++)d[b++]=Math.round(tracking.Math.uniformRandom(-15,16)),d[b++]=Math.round(tracking.Math.uniformRandom(-15,16)),d[b++]=Math.round(tracking.Math.uniformRandom(-15,16)),d[b++]=Math.round(tracking.Math.uniformRandom(-15,16));this.randomWindowOffsets_=d}if(!this.randomImageOffsets_[a]){b=0;d=new Int32Array(2*this.N);for(c=0;c<this.N;c++)d[b++]=this.randomWindowOffsets_[4*c]*a+this.randomWindowOffsets_[4*c+
1],d[b++]=this.randomWindowOffsets_[4*c+2]*a+this.randomWindowOffsets_[4*c+3];this.randomImageOffsets_[a]=d}return this.randomImageOffsets_[a]}})();
(function(){tracking.Fast={};tracking.Fast.THRESHOLD=40;tracking.Fast.circles_={};tracking.Fast.findCorners=function(a,b,d,c){var e=this.getCircleOffsets_(b),f=new Int32Array(16),g=[];void 0===c&&(c=this.THRESHOLD);for(var h=3;h<d-3;h++)for(var k=3;k<b-3;k++){for(var l=h*b+k,m=a[l],n=0;16>n;n++)f[n]=a[l+e[n]];this.isCorner(m,f,c)&&(g.push(k,h),k+=3)}return g};tracking.Fast.isBrighter=function(a,b,d){return a-b>d};tracking.Fast.isCorner=function(a,b,d){if(this.isTriviallyExcluded(b,a,d))return!1;for(var c=
0;16>c;c++){for(var e=!0,f=!0,g=0;9>g;g++){var h=b[c+g&15];if(!this.isBrighter(a,h,d)&&(f=!1,!1===e))break;if(!this.isDarker(a,h,d)&&(e=!1,!1===f))break}if(f||e)return!0}return!1};tracking.Fast.isDarker=function(a,b,d){return b-a>d};tracking.Fast.isTriviallyExcluded=function(a,b,d){var c=0,e=a[8],f=a[12],g=a[4];a=a[0];this.isBrighter(a,b,d)&&c++;this.isBrighter(g,b,d)&&c++;this.isBrighter(e,b,d)&&c++;this.isBrighter(f,b,d)&&c++;return 3>c&&(c=0,this.isDarker(a,b,d)&&c++,this.isDarker(g,b,d)&&c++,
this.isDarker(e,b,d)&&c++,this.isDarker(f,b,d)&&c++,3>c)?!0:!1};tracking.Fast.getCircleOffsets_=function(a){if(this.circles_[a])return this.circles_[a];var b=new Int32Array(16);b[0]=-a-a-a;b[1]=b[0]+1;b[2]=b[1]+a+1;b[3]=b[2]+a+1;b[4]=b[3]+a;b[5]=b[4]+a;b[6]=b[5]+a-1;b[7]=b[6]+a-1;b[8]=b[7]-1;b[9]=b[8]-1;b[10]=b[9]-a-1;b[11]=b[10]-a-1;b[12]=b[11]-a;b[13]=b[12]-a;b[14]=b[13]-a+1;b[15]=b[14]-a+1;return this.circles_[a]=b}})();
(function(){tracking.Math={};tracking.Math.distance=function(a,b,d,c){a=d-a;b=c-b;return Math.sqrt(a*a+b*b)};tracking.Math.hammingWeight=function(a){a-=a>>1&1431655765;a=(a&858993459)+(a>>2&858993459);return 16843009*(a+(a>>4)&252645135)>>24};tracking.Math.uniformRandom=function(a,b){return a+Math.random()*(b-a)};tracking.Math.intersectRect=function(a,b,d,c,e,f,g,h){return!(e>d||g<a||f>c||h<b)}})();
(function(){tracking.Matrix={};tracking.Matrix.forEach=function(a,b,d,c,e){e=e||1;for(var f=0;f<d;f+=e)for(var g=0;g<b;g+=e){var h=f*b*4+4*g;c.call(this,a[h],a[h+1],a[h+2],a[h+3],h,f,g)}};tracking.Matrix.sub=function(a,b){for(var d=tracking.Matrix.clone(a),c=0;c<d.length;c++)for(var e=0;e<d[c].length;e++)d[c][e]-=b[c][e];return d};tracking.Matrix.add=function(a,b){for(var d=tracking.Matrix.clone(a),c=0;c<d.length;c++)for(var e=0;e<d[c].length;e++)d[c][e]+=b[c][e];return d};tracking.Matrix.clone=function(a,
b,d){b=b||a[0].length;d=d||a.length;for(var c=Array(d);d--;){c[d]=Array(b);for(var e=b;e--;)c[d][e]=a[d][e]}return c};tracking.Matrix.mulScalar=function(a,b){for(var d=tracking.Matrix.clone(b),c=0;c<b.length;c++)for(var e=0;e<b[c].length;e++)d[c][e]*=a;return d};tracking.Matrix.transpose=function(a){for(var b=Array(a[0].length),d=0;d<a[0].length;d++){b[d]=Array(a.length);for(var c=0;c<a.length;c++)b[d][c]=a[c][d]}return b};tracking.Matrix.mul=function(a,b){for(var d=Array(a.length),c=0;c<a.length;c++){d[c]=
Array(b[0].length);for(var e=0;e<b[0].length;e++)for(var f=d[c][e]=0;f<a[0].length;f++)d[c][e]+=a[c][f]*b[f][e]}return d};tracking.Matrix.norm=function(a){for(var b=0,d=0;d<a.length;d++)for(var c=0;c<a[d].length;c++)b+=a[d][c]*a[d][c];return Math.sqrt(b)};tracking.Matrix.calcCovarMatrix=function(a){for(var b=Array(a.length),d=0;d<a.length;d++){b[d]=[0];for(var c=0;c<a[d].length;c++)b[d][0]+=a[d][c]/a[d].length}var e=tracking.Matrix.clone(b);for(d=0;d<e.length;d++)for(c=0;c<a[0].length-1;c++)e[d].push(e[d][0]);
a=tracking.Matrix.sub(a,e);d=tracking.Matrix.transpose(a);return[tracking.Matrix.mul(d,a),b]}})();(function(){tracking.EPnP={};tracking.EPnP.solve=function(a,b,d){}})();(function(){tracking.Tracker=function(){tracking.Tracker.base(this,"constructor")};tracking.inherits(tracking.Tracker,tracking.EventEmitter);tracking.Tracker.prototype.track=function(){}})();
(function(){tracking.TrackerTask=function(a){tracking.TrackerTask.base(this,"constructor");if(!a)throw Error("Tracker instance not specified.");this.setTracker(a)};tracking.inherits(tracking.TrackerTask,tracking.EventEmitter);tracking.TrackerTask.prototype.tracker_=null;tracking.TrackerTask.prototype.running_=!1;tracking.TrackerTask.prototype.getTracker=function(){return this.tracker_};tracking.TrackerTask.prototype.inRunning=function(){return this.running_};tracking.TrackerTask.prototype.setRunning=
function(a){this.running_=a};tracking.TrackerTask.prototype.setTracker=function(a){this.tracker_=a};tracking.TrackerTask.prototype.run=function(){var a=this;if(!this.inRunning())return this.setRunning(!0),this.reemitTrackEvent_=function(b){a.emit("track",b)},this.tracker_.on("track",this.reemitTrackEvent_),this.emit("run"),this};tracking.TrackerTask.prototype.stop=function(){if(this.inRunning())return this.setRunning(!1),this.emit("stop"),this.tracker_.removeListener("track",this.reemitTrackEvent_),
this}})();
(function(){tracking.ColorTracker=function(a){tracking.ColorTracker.base(this,"constructor");"string"===typeof a&&(a=[a]);a&&(a.forEach(function(a){if(!tracking.ColorTracker.getColor(a))throw Error('Color not valid, try `new tracking.ColorTracker("magenta")`.');}),this.setColors(a))};tracking.inherits(tracking.ColorTracker,tracking.Tracker);tracking.ColorTracker.knownColors_={};tracking.ColorTracker.neighbours_={};tracking.ColorTracker.registerColor=function(a,c){tracking.ColorTracker.knownColors_[a]=c};
tracking.ColorTracker.getColor=function(a){return tracking.ColorTracker.knownColors_[a]};tracking.ColorTracker.prototype.colors=["magenta"];tracking.ColorTracker.prototype.minDimension=20;tracking.ColorTracker.prototype.maxDimension=Infinity;tracking.ColorTracker.prototype.minGroupSize=30;tracking.ColorTracker.prototype.calculateDimensions_=function(a,c){for(var d=-1,b=-1,g=Infinity,h=Infinity,k=0;k<c;k+=2){var l=a[k],m=a[k+1];l<g&&(g=l);l>d&&(d=l);m<h&&(h=m);m>b&&(b=m)}return{width:d-g,height:b-
h,x:g,y:h}};tracking.ColorTracker.prototype.getColors=function(){return this.colors};tracking.ColorTracker.prototype.getMinDimension=function(){return this.minDimension};tracking.ColorTracker.prototype.getMaxDimension=function(){return this.maxDimension};tracking.ColorTracker.prototype.getMinGroupSize=function(){return this.minGroupSize};tracking.ColorTracker.prototype.getNeighboursForWidth_=function(a){if(tracking.ColorTracker.neighbours_[a])return tracking.ColorTracker.neighbours_[a];var c=new Int32Array(8);
c[0]=4*-a;c[1]=4*-a+4;c[2]=4;c[3]=4*a+4;c[4]=4*a;c[5]=4*a-4;c[6]=-4;c[7]=4*-a-4;return tracking.ColorTracker.neighbours_[a]=c};tracking.ColorTracker.prototype.mergeRectangles_=function(a){for(var c,d=[],b=this.getMinDimension(),g=this.getMaxDimension(),h=0;h<a.length;h++){var k=a[h];c=!0;for(var l=h+1;l<a.length;l++){var m=a[l];if(tracking.Math.intersectRect(k.x,k.y,k.x+k.width,k.y+k.height,m.x,m.y,m.x+m.width,m.y+m.height)){c=!1;l=Math.min(k.x,m.x);var n=Math.min(k.y,m.y),p=Math.max(k.x+k.width,
m.x+m.width);m.height=Math.max(k.y+k.height,m.y+m.height)-n;m.width=p-l;m.x=l;m.y=n;break}}c&&k.width>=b&&k.height>=b&&k.width<=g&&k.height<=g&&d.push(k)}return d};tracking.ColorTracker.prototype.setColors=function(a){this.colors=a};tracking.ColorTracker.prototype.setMinDimension=function(a){this.minDimension=a};tracking.ColorTracker.prototype.setMaxDimension=function(a){this.maxDimension=a};tracking.ColorTracker.prototype.setMinGroupSize=function(a){this.minGroupSize=a};tracking.ColorTracker.prototype.track=
function(a,c,b){var d=this,e=this.getColors();if(!e)throw Error('Colors not specified, try `new tracking.ColorTracker("magenta")`.');var h=[];e.forEach(function(e){h=h.concat(d.trackColor_(a,c,b,e))});this.emit("track",{data:h})};tracking.ColorTracker.prototype.trackColor_=function(d,c,e,f){var g=tracking.ColorTracker.knownColors_[f],h=new Int32Array(d.length>>2),k=new Int8Array(d.length),l=this.getMinGroupSize(),m=this.getNeighboursForWidth_(c),n=new Int32Array(d.length),p=[],v=-4;if(!g)return p;
for(var x=0;x<e;x++)for(var w=0;w<c;w++)if(v+=4,!k[v]){var u=0;var t=-1;n[++t]=v;n[++t]=x;n[++t]=w;for(k[v]=1;0<=t;){var q=n[t--];var r=n[t--];var z=n[t--];if(g(d[z],d[z+1],d[z+2],d[z+3],z,r,q)){h[u++]=q;h[u++]=r;for(var y=0;y<m.length;y++){var C=z+m[y],A=r+a[y],B=q+b[y];!k[C]&&0<=A&&A<e&&0<=B&&B<c&&(n[++t]=C,n[++t]=A,n[++t]=B,k[C]=1)}}}u>=l&&(r=this.calculateDimensions_(h,u))&&(r.color=f,r.area=parseInt(u/2),p.push(r))}return this.mergeRectangles_(p)};tracking.ColorTracker.registerColor("cyan",function(a,
c,b){var d=a-0,e=c-255,h=b-255;return 50<=c-a&&70<=b-a?!0:6400>d*d+e*e+h*h});tracking.ColorTracker.registerColor("magenta",function(a,c,b){var d=a-255,e=c-0,h=b-255;return 50<=a-c&&50<=b-c?!0:19600>d*d+e*e+h*h});tracking.ColorTracker.registerColor("yellow",function(a,c,b){var d=a-255,e=c-255,h=b-0;return 50<=a-b&&50<=c-b?!0:1E4>d*d+e*e+h*h});var a=new Int32Array([-1,-1,0,1,1,1,0,-1]),b=new Int32Array([0,1,1,1,0,-1,-1,-1])})();
(function(){tracking.ObjectTracker=function(a){tracking.ObjectTracker.base(this,"constructor");a&&(Array.isArray(a)||(a=[a]),Array.isArray(a)&&a.forEach(function(b,d){"string"===typeof b&&(a[d]=tracking.ViolaJones.classifiers[b]);if(!a[d])throw Error('Object classifier not valid, try `new tracking.ObjectTracker("face")`.');}));this.setClassifiers(a)};tracking.inherits(tracking.ObjectTracker,tracking.Tracker);tracking.ObjectTracker.prototype.edgesDensity=.2;tracking.ObjectTracker.prototype.initialScale=
1;tracking.ObjectTracker.prototype.scaleFactor=1.25;tracking.ObjectTracker.prototype.stepSize=1.5;tracking.ObjectTracker.prototype.getClassifiers=function(){return this.classifiers};tracking.ObjectTracker.prototype.getEdgesDensity=function(){return this.edgesDensity};tracking.ObjectTracker.prototype.getInitialScale=function(){return this.initialScale};tracking.ObjectTracker.prototype.getScaleFactor=function(){return this.scaleFactor};tracking.ObjectTracker.prototype.getStepSize=function(){return this.stepSize};
tracking.ObjectTracker.prototype.track=function(a,b,d){var c=this,e=this.getClassifiers();if(!e)throw Error('Object classifier not specified, try `new tracking.ObjectTracker("face")`.');var f=[];e.forEach(function(e){f=f.concat(tracking.ViolaJones.detect(a,b,d,c.getInitialScale(),c.getScaleFactor(),c.getStepSize(),c.getEdgesDensity(),e))});this.emit("track",{data:f})};tracking.ObjectTracker.prototype.setClassifiers=function(a){this.classifiers=a};tracking.ObjectTracker.prototype.setEdgesDensity=function(a){this.edgesDensity=
a};tracking.ObjectTracker.prototype.setInitialScale=function(a){this.initialScale=a};tracking.ObjectTracker.prototype.setScaleFactor=function(a){this.scaleFactor=a};tracking.ObjectTracker.prototype.setStepSize=function(a){this.stepSize=a}})();
(function(){tracking.LandmarksTracker=function(){tracking.LandmarksTracker.base(this,"constructor")};tracking.inherits(tracking.LandmarksTracker,tracking.ObjectTracker);tracking.LandmarksTracker.prototype.track=function(a,b,d){var c=tracking.ViolaJones.classifiers.face;c=tracking.ViolaJones.detect(a,b,d,this.getInitialScale(),this.getScaleFactor(),this.getStepSize(),this.getEdgesDensity(),c);a=tracking.LBF.align(a,b,d,c);this.emit("track",{data:{faces:c,landmarks:a}})}})();
(function(){tracking.LBF={};tracking.LBF.Regressor=function(a){this.maxNumStages=a;this.rfs=Array(a);this.models=Array(a);for(var b=0;b<a;b++)this.rfs[b]=new tracking.LBF.RandomForest(b),this.models[b]=tracking.LBF.RegressorData[b].models;this.meanShape=tracking.LBF.LandmarksData};tracking.LBF.Regressor.prototype.predict=function(a,b,d,c){var e=[],f=[],g=[],h=tracking.Matrix.clone(this.meanShape);e.push({data:a,width:b,height:d});g.push(c);f.push(tracking.LBF.projectShapeToBoundingBox_(h,c));for(a=
0;a<this.maxNumStages;a++)b=tracking.LBF.Regressor.deriveBinaryFeat(this.rfs[a],e,f,g,h),this.applyGlobalPrediction(b,this.models[a],f,g);return f[0]};tracking.LBF.Regressor.prototype.applyGlobalPrediction=function(a,b,d,c){for(var e=2*d[0].length,f=Array(e/2),g=0;g<e/2;g++)f[g]=[0,0];for(g=0;g<d.length;g++){for(var h=0;h<e;h++){for(var k=0,l=0,m;-1!=(m=a[g][l].index);l++)m<=b[h].nr_feature&&(k+=b[h].data[m-1]*a[g][l].value);h<e/2?f[h][0]=k:f[h-e/2][1]=k}h=tracking.LBF.similarityTransform_(tracking.LBF.unprojectShapeToBoundingBox_(d[g],
c[g]),this.meanShape);tracking.Matrix.transpose(h[0]);h=tracking.LBF.unprojectShapeToBoundingBox_(d[g],c[g]);h=tracking.Matrix.add(h,f);d[g]=tracking.LBF.projectShapeToBoundingBox_(h,c[g])}};tracking.LBF.Regressor.deriveBinaryFeat=function(a,b,d,c,e){for(var f=Array(b.length),g=0;g<b.length;g++){var h=a.maxNumTrees*a.landmarkNum+1;f[g]=Array(h);for(var k=0;k<h;k++)f[g][k]={}}h=1<<a.maxDepth-1;for(g=0;g<b.length;g++){k=tracking.LBF.unprojectShapeToBoundingBox_(d[g],c[g]);var l=tracking.LBF.similarityTransform_(k,
e);for(k=0;k<a.landmarkNum;k++)for(var m=0;m<a.maxNumTrees;m++){var n=tracking.LBF.Regressor.getCodeFromTree(a.rfs[k][m],b[g],d[g],c[g],l[0],l[1]),p=k*a.maxNumTrees+m;f[g][p].index=h*p+n;f[g][p].value=1}f[g][a.landmarkNum*a.maxNumTrees].index=-1;f[g][a.landmarkNum*a.maxNumTrees].value=-1}return f};tracking.LBF.Regressor.getCodeFromTree=function(a,b,d,c,e,f){for(f=0;;){var g=Math.cos(a.nodes[f].feats[0])*a.nodes[f].feats[2]*a.maxRadioRadius*c.width,h=Math.sin(a.nodes[f].feats[0])*a.nodes[f].feats[2]*
a.maxRadioRadius*c.height,k=Math.cos(a.nodes[f].feats[1])*a.nodes[f].feats[3]*a.maxRadioRadius*c.width,l=Math.sin(a.nodes[f].feats[1])*a.nodes[f].feats[3]*a.maxRadioRadius*c.height,m=Math.floor(e[0][0]*g+e[0][1]*h+d[a.landmarkID][0]);g=Math.floor(e[1][0]*g+e[1][1]*h+d[a.landmarkID][1]);m=Math.max(0,Math.min(m,b.height-1));g=Math.max(0,Math.min(g,b.width-1));h=Math.floor(e[0][0]*k+e[0][1]*l+d[a.landmarkID][0]);k=Math.floor(e[1][0]*k+e[1][1]*l+d[a.landmarkID][1]);h=Math.max(0,Math.min(h,b.height-1));
k=Math.max(0,Math.min(k,b.width-1));f=Math.floor(b.data[g*b.width+m])-Math.floor(b.data[k*b.width+h])<a.nodes[f].thresh?a.nodes[f].cnodes[0]:a.nodes[f].cnodes[1];if(1==a.nodes[f].is_leafnode){b=1;for(d=0;d<a.leafnodes.length&&a.leafnodes[d]!=f;d++)b++;return b}}}})();
(function(){tracking.LBF.maxNumStages=4;tracking.LBF.regressor_=null;tracking.LBF.align=function(a,b,d,c){null==tracking.LBF.regressor_&&(tracking.LBF.regressor_=new tracking.LBF.Regressor(tracking.LBF.maxNumStages));a=tracking.Image.grayscale(a,b,d,!1);a=tracking.Image.equalizeHist(a,b,d);var e=Array(c.length),f;for(f in c){c[f].height=c[f].width;var g={};g.startX=c[f].x;g.startY=c[f].y;g.width=c[f].width;g.height=c[f].height;e[f]=tracking.LBF.regressor_.predict(a,b,d,g)}return e};tracking.LBF.unprojectShapeToBoundingBox_=
function(a,b){for(var d=Array(a.length),c=0;c<a.length;c++)d[c]=[(a[c][0]-b.startX)/b.width,(a[c][1]-b.startY)/b.height];return d};tracking.LBF.projectShapeToBoundingBox_=function(a,b){for(var d=Array(a.length),c=0;c<a.length;c++)d[c]=[a[c][0]*b.width+b.startX,a[c][1]*b.height+b.startY];return d};tracking.LBF.similarityTransform_=function(a,b){for(var d=[0,0],c=[0,0],e=0;e<a.length;e++)d[0]+=a[e][0],d[1]+=a[e][1],c[0]+=b[e][0],c[1]+=b[e][1];d[0]/=a.length;d[1]/=a.length;c[0]/=b.length;c[1]/=b.length;
var f=tracking.Matrix.clone(a),g=tracking.Matrix.clone(b);for(e=0;e<a.length;e++)f[e][0]-=d[0],f[e][1]-=d[1],g[e][0]-=c[0],g[e][1]-=c[1];e=tracking.Matrix.calcCovarMatrix(f);d=e[0];e=tracking.Matrix.calcCovarMatrix(g);c=e[0];e=Math.sqrt(tracking.Matrix.norm(d));c=Math.sqrt(tracking.Matrix.norm(c));d=e/c;f=tracking.Matrix.mulScalar(1/e,f);g=tracking.Matrix.mulScalar(1/c,g);var h=0;for(e=c=0;e<a.length;e++)h=h+f[e][1]*g[e][0]-f[e][0]*g[e][1],c=c+f[e][0]*g[e][0]+f[e][1]*g[e][1];f=Math.sqrt(h*h+c*c);
g=h/f;f=c/f;return[[[f,-g],[g,f]],d]};tracking.LBF.RandomForest=function(a){this.maxNumTrees=tracking.LBF.RegressorData[a].max_numtrees;this.landmarkNum=tracking.LBF.RegressorData[a].num_landmark;this.maxDepth=tracking.LBF.RegressorData[a].max_depth;this.stages=tracking.LBF.RegressorData[a].stages;this.rfs=Array(this.landmarkNum);for(var b=0;b<this.landmarkNum;b++){this.rfs[b]=Array(this.maxNumTrees);for(var d=0;d<this.maxNumTrees;d++)this.rfs[b][d]=new tracking.LBF.Tree(a,b,d)}};tracking.LBF.Tree=
function(a,b,d){a=tracking.LBF.RegressorData[a].landmarks[b][d];this.maxDepth=a.max_depth;this.maxNumNodes=a.max_numnodes;this.nodes=a.nodes;this.landmarkID=a.landmark_id;this.numLeafnodes=a.num_leafnodes;this.numNodes=a.num_nodes;this.maxNumFeats=a.max_numfeats;this.maxRadioRadius=a.max_radio_radius;this.leafnodes=a.id_leafnodes}})();