RoboidRunner={robots:{},robotsByGroup:{},robotsByModule:{},components:{},packet:{},retryId:void 0,alive:!1,canSend:!1,addRobotByModule:function(a,b,c){var d=RoboidRunner.robotsByModule[a];void 0===d&&(d=RoboidRunner.robotsByModule[a]={});d[b]=c},getOrCreateRobot:function(a,b,c){var d=RoboidRunner.robots,f=b+c,e=d[f];e||("hamster"==b?e=new Hamster(c):"hamsterS"==b?e=new HamsterS(c):"turtle"==b?e=new Turtle(c):"albertschool"==b?e=new AlbertSchool(c):"uoalbert"==b?e=new UoAlbert(c):"albertai"==b?e=new AlbertAi(c):
"cheese"==b?e=new Cheese(c):"zerone"==b?e=new ZeroneRobot(c):"brown"==b?e=new LineRobot(c,b):"sally"==b&&(e=new LineRobot(c,b)),e&&(d[f]=e,RoboidRunner.packet[f]=e.motoring,RoboidRunner.addRobotByModule(b,f,e)));return RoboidRunner.robotsByGroup[a+c]=e},getRobot:function(a,b){return RoboidRunner.robotsByGroup[a+b]},addComponent:function(a,b){RoboidRunner.components[a]=b},clearMotorings:function(){var a=RoboidRunner.robots,b;for(b in a)a[b].clearMotoring()},afterTick:function(){var a=RoboidRunner.robots,
b;for(b in a)a[b].clearEvent();a=RoboidRunner.components;for(var c in a)a[c].clearEvent()},reset:function(a){if(a=RoboidRunner.robotsByModule[a])for(var b in a)a[b].reset()},open:function(){if("WebSocket"in window)try{var a=RoboidRunner,b=new WebSocket("ws://localhost:55417");b.binaryType="arraybuffer";a.socket=b;b.onmessage=function(c){try{var d=JSON.parse(c.data);if(0==d.type)__fh_qHdl_Em.setConnectionState(d.states);else if(2==d.type){__fh_qHdl_Em.setConfig("level"+d.level,d.multi);for(var f in d.modules)__fh_qHdl_Em.loadExtension(f)}else if(0<=
d.index){var e=a.getOrCreateRobot(d.group,d.module,d.index);e&&(e.sensory=d,e.handleSensory());__fh_qHdl_Em.loadExtension(d.module)}}catch(g){}};b.onclose=function(){a.alive=!1;a.canSend=!1;__fh_qHdl_Em.setServerState(!1);void 0===a.retryId&&(a.retryId=setInterval(function(){a.alive?void 0!==a.retryId&&(clearInterval(a.retryId),a.retryId=void 0):a.open()},2E3))};b.onopen=function(){a.alive=!0;__fh_qHdl_Em.setServerState(!0);var c=Date.now(),d=function(){if(a.canSend&&a.socket){if(Date.now()>c){try{var f=
JSON.stringify(a.packet);a.canSend&&a.socket&&a.socket.send(f);a.clearMotorings()}catch(e){}c+=20}setTimeout(d,5)}};a.canSend=!0;d()};return!0}catch(c){}return!1},close:function(){RoboidRunner.canSend=!1;RoboidRunner.socket&&(RoboidRunner.socket.close(),RoboidRunner.socket=void 0)}};window.addEventListener("load",function(){Date.now||(Date.now=function(){return(new Date).getTime()});__fh_qHdl_Em.setTickCallback(RoboidRunner.afterTick);setTimeout(function(){RoboidRunner.open()},1E3)});